# 算数マスターたかし

算数マスターとは，素早く正確に足し算や引き算，さらには掛け算や割り算などを計算することができる人材です．

わたしは機械学習で計算マスターを作ることにしました．

学習モデルの名前は「たかし」です．たかしくんと呼んでください．

##  たかし学習の環境構築
たかしの学習には`PyTorch==1.7.0`が必要です．
pipやanacondaでインストールしてください．
Docker環境がある場合は，Dockerを使うと楽かもしれません．

##  Dockerによるたかしの学習の環境構築
たかしの学習環境は仮想環境を利用しても作ることができます．
たかしはバーチャルな存在なのです．

### コンテナのビルド
以下のコマンドでたかしの学習用コンテナを作ることができます．
```
$docker build . -t takashi
$docker run -it -v /path/to/SansuMasterTakashi/takashi:/takashi takashi
```

### コンテナの再開
```
$docker exec -it <<CONTAINER ID>> bash
```

# 問題集の準備
たかしくんが解く練習ワークとテストを生成します．`/takashi/src`フォルダに移動してください．
```
$python3 create_datasets.py
```
で問題集を作成できますが，いくつかオプションをつけることができます．
`python3 create_datasets.py -h`とするとオプション一覧を見ることができます．
ここでは掛け算と割り算も含めた計算マスターたかしを作りたいので、
```
$python3 create_datasets.py --include_kakezan --include_warizan
```
としてワークを作成します．

作成先のフォルダは`takashi/data/datasets`がデフォルトになっています．確認しましょう．

確認すると，次のようになっているはずです．左側が式，右側が答えです．

毎回ランダムに生成されるので，実際の式や答えは違っていると思います．
```
6*4-5	19
5+4+1+2	12
4*6-3	21
8*9*8	576
8/4+4	6
(3-1)*(8+6)	28
7+2	9
1+6-3	4
4*3	12
8+8-5	11
...
```
いい感じに小学校っぽい算数の問題が生成されていることがわかります．
* 答えや計算過程で0以下が登場することはない．
* 割り算で小数点がでることはない．
* 割り算と掛け算は先に計算する．ただし括弧があれば括弧の中を先に計算する．
* 答えが大きすぎるものは望ましくない．
これらが（だいたい）満たされた問題が生成されていると思います．
なお，中括弧や大括弧は括弧には対応していません．

なお，オプションによっては難しくすることもできます．
```
$python3 create_datasets.py --max_depth 5 --include_kakezan --include_warizan
```
とすると，括弧の深度が最大5となり人間にとってもクッソめんどくさい式が生成できます．
```
(9*6/6-(7/(3/3))+7-4+6+7)/(1/1)	18
(4+5)/(9/3)*5*4/5-2-4	6
3-(4-(5-(9/3)))+3	4
5+2+9+4-(9/3)	17
5+7-((8-3-3)/1+2)	8
6+9/3+9+3*2+8-(1/1+1)-(8-4)	26
5+9	14
5*9	45
4+4+7/((4+7-(7-3))/(6/(7-1)))	9
(3-((3+2)/(1+4)))*(1+3+7*6+2/2)-4	90
...
```
# ワークの前処理（トークン化）


# たかしの学習
たかしくんは勤勉なので、10000問のワークを100週してもらうことになりました。
たかしくんはかしこいので、同時に100問解くことができます。


訓練用データセットのサンプル数（ワークの収録問題数）:10000問
テスト用データセットのサンプル数（算数テストの問題数）:1000問
エポック数（ワークを何週するか？）:100週
バッチ数（たかしが同時に解く問題数）:100問
学習率: 0.001
損失関数: クロスエントロピー誤差
オプティマイザ: Adam
